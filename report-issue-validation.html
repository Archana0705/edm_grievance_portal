<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Enhanced Dashboard</title>
  <!-- Bootstrap CSS -->

  <link href="assets/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/font/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/css/aos.css" rel="stylesheet">

  <style>
    .error-message {
      color: red;
      font-size: 0.85rem;
    }

    .is-invalid {
      border-color: red;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f1f3f6;
      color: #333;
    }

    body {
      display: flex;
      flex-direction: column;
      padding-top: 70px;
      transition: all 0.3s;
    }

    /* Header */
    nav.navbar {
      background: linear-gradient(90deg, #4b6cb7, #182848);
      color: #fff;
      z-index: 1000;
      padding: 0.4rem 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    nav.navbar .navbar-brand,
    nav.navbar .btn,
    nav.navbar span {
      color: #fff;
    }

    nav.navbar .btn-light {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: #fff;
    }

    nav.navbar .btn-light:hover {
      background: rgba(255, 255, 255, 0.25);
    }

    /* Sidebar */
    #sidebar {
      position: fixed;
      top: 70px;
      left: 0;
      width: 220px;
      height: calc(100% - 70px);
      background: #fff;
      padding-top: 1rem;
      transition: all 0.3s;
      overflow-y: auto;
      border-right: 1px solid #e0e0e0;
      box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
      z-index: 999;
    }

    #sidebar a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: #495057;
      text-decoration: none;
      font-weight: 500;
      border-radius: 8px;
      margin: 4px 10px;
      transition: all 0.2s ease-in-out;
    }

    #sidebar a:hover {
      background: #4b6cb7;
      color: #fff;
      transform: translateX(5px);
    }

    #sidebar a.active {
      background: #182848;
      color: white;
    }

    #sidebar i {
      margin-right: 12px;
      font-size: 1.2rem;
    }

    .sidebar-collapsed #sidebar a {
      padding: 12px 0px;
    }

    /* Collapsed sidebar */
    body.sidebar-collapsed #sidebar {
      width: 60px;
    }

    body.sidebar-collapsed #sidebar a span {
      display: none;
    }

    body.sidebar-collapsed #sidebar a i {
      margin-right: 0;
      width: 100%;
      text-align: center;
    }

    /* Main content */
    #mainContent {
      margin-left: 220px;
      padding: 30px;
      flex: 1;
      transition: all 0.3s;
    }

    body.sidebar-collapsed #mainContent {
      margin-left: 60px;
    }

    /* Cards for main content */
    .card {
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    /* Footer */
    footer {
      background: #fff;
      text-align: center;
      padding: 15px;
      border-top: 1px solid #ddd;
      width: 100%;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
    }

    /* Mobile responsiveness */
    @media (max-width: 992px) {
      #sidebar {
        left: -100%;
        top: 0;
        width: 220px;
        height: 100%;
        border-right: none;
        box-shadow: 2px 0 15px rgba(0, 0, 0, 0.2);
        z-index: 9999;
      }

      #sidebar.show {
        left: 0;
      }

      #mainContent {
        margin-left: 0;
        padding: 20px 10px;
      }

      body.sidebar-collapsed #mainContent {
        margin-left: 0;
      }
    }

    @media (max-width: 768px) {
      #currentDateTime {
        display: none;
      }

      .navbar .fw-bold {
        font-size: 1.1rem;
      }

      #sidebarToggle {
        padding: 0.35rem 0.6rem;
      }

      .dropdown-toggle span {
        display: none;
      }
    }
  </style>
  <!-- main content -->
  <style>
    .hover-shadow:hover {
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      transition: all 0.3s;
    }

    .card h3 {
      font-weight: 600;
    }

    .card i {
      transition: transform 0.3s;
    }

    .card:hover i {
      transform: scale(1.2);
    }

    .table-hover tbody tr:hover {
      background-color: #f1f3f5;
    }
  </style>
  <!-- main content -->
  <!-- page css -->
  <style>
    body {
      background: #f8f9fa;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .form-section {
      background: #fff;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .form-label {
      font-weight: 500;
    }

    .btn-submit {
      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
      border: none;
      color: #fff;
      font-weight: 600;
      border-radius: 8px;
      transition: 0.3s;
    }

    .btn-submit:hover {
      transform: scale(1.03);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }
  </style>
  <style>
    /* Toast positioning */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 2000;
    }
  </style>
  <!-- page css -->
</head>

<body>
  <!-- Header -->
  <nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid d-flex align-items-center">
      <button class="btn btn-light" id="sidebarToggle">
        <i class="bi bi-list fs-4"></i>
      </button>
      <span class="fw-bold ms-3 fs-5">My Dashboard</span>
      <div class="ms-auto d-flex align-items-center gap-3">
        <span id="currentDateTime" class="me-3"></span>
        <div class="dropdown">
          <button class="btn btn-light dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle fs-4"></i> <span class="d-none d-lg-inline fw-semibold">John</span>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
            <li><a class="dropdown-item" href="profile.html">Profile</a></li>
            <li><a class="dropdown-item" href="index.html">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>
  <!-- Sidebar -->
  <div id="sidebar">
    <a href="dashboard.html"><i class="bi bi-house"></i><span>Dashboard</span></a>
    <a href="report-global-page.html"><i class="bi bi-file-earmark-text"></i><span>Report Issue</span></a>

    <a href="profile.html"><i class="bi bi-person"></i><span>Profile</span></a>
    <a href="faq.html"><i class="bi bi-question-circle"></i><span>FAQ</span></a>
  </div>
  <!-- Main Content -->
  <div id="mainContent">
    <div class="container">
      <h2 class="page-title"><i class="bi bi-exclamation-triangle-fill text-danger me-2"></i> Report an Issue - Self
      </h2>
      <div class="form-section">
        <!-- Main Form -->
        <form id="issueForm" class="needs-validation" novalidate>
          <div class="row g-3">
            <!-- Dropdowns -->
            <div class="mb-3 col-lg-4">
              <label>Type</label>
              <select id="typeSelect" class="form-control">
                <option value="">Select Type</option>
              </select>
            </div>
            <div class="mb-3 col-lg-4">
              <label>Category</label>
              <select id="categorySelect" class="form-control">
                <option value="">Select Category</option>
              </select>
            </div>
            <div class="mb-3 col-lg-4">
              <label>Sub-Category</label>
              <select id="subCategorySelect" class="form-control">
                <option value="">Select Sub-Category</option>
              </select>
            </div>
          </div>
          <!-- Dynamic Form -->
          <div id="formFields" class="mt-4"></div>

          <!-- Declaration Component -->
          <div class="alert alert-light border rounded-3 shadow-sm p-3 mb-4" role="alert">
            <div class="d-flex align-items-start">
              <i class="bi bi-info-circle-fill text-primary fs-4 me-3"></i>
              <div>
                <h6 class="fw-bold mb-2">Declaration</h6>
                <p class="mb-2 small text-muted">
                  I hereby declare that the information provided in this portal is true and correct
                  to the best of my knowledge. Any false information may lead to rejection of the grievance.
                </p>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="declarationCheck">
                  <label class="form-check-label small" for="declarationCheck">
                    I agree to the terms of this declaration
                  </label>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-4 d-flex align-items-center mt-2">
            <button type="submit" class="btn btn-primary px-4 py-2">
              <i class="bi bi-send-fill me-2"></i> Submit Issue
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer>
    &copy; 2025 My Dashboard. All rights reserved.
  </footer>
  <!-- Toast -->
  <div class="toast-container">
    <div id="successToast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body">
          <i class="bi bi-check-circle-fill me-2"></i> Issue submitted successfully!
        </div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>
  <!-- Bootstrap JS -->

  <script src="assets/js/jquery-3.7.1.min.js"></script>
  <!-- <script src="assets/js/bootstrap.bundle.min.js"></script> -->
  <script src="assets/js/aos.js"></script>
  <script src="assets/js/dataTableUtil.js"></script>
  <script src="assets/js/crypto-js.min.js"></script>
  <script src="assets/js/global.js"></script>
  <script src="assets/js/encrypt_decrypt.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/js/toastUtil.js"></script>
  <script src="assets/js/apiConfig.js"></script>
  <script src="assets/js/globalProfileDropdown.js"></script>

  <script>
    // Sidebar toggle
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');

    sidebarToggle.addEventListener('click', () => {
      if (window.innerWidth < 992) {
        // Mobile: slide in/out
        sidebar.classList.toggle('show');
      } else {
        // Desktop: collapse sidebar
        document.body.classList.toggle('sidebar-collapsed');
      }
    });

    // Close mobile sidebar when clicking outside
    document.addEventListener('click', function (e) {
      if (window.innerWidth < 992) {
        if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
          sidebar.classList.remove('show');
        }
      }
    });

    // Display current date and time
    function updateDateTime() {
      const now = new Date();
      const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
      const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      document.getElementById('currentDateTime').textContent = now.toLocaleDateString(undefined, options) + ' ' + timeString;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();
  </script>


  <script>
    // ðŸ”¹ Static JSON config (for dynamic fields)
    const formConfig = {

      "eSevai portal and services": {
        "Status Check": {
          "eService": [
            "Enter the acknowledgement number (in the redirected portal)"
          ],
          "Grievance": [
            "Enter the acknowledgement number"
          ]
        },
        "CAN Related": {
          "CAN edit": [
            "Enter CAN Number to be edited: (mandatory)",
            "Enter description of changes and reason for change request: (mandatory)",
            "Supporting document description (mandatory, short text)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Delete duplicate CAN": [
            "Enter CAN Number to be deleted (mandatory)",
            "Enter description with Reason for request and details of multiple CAN numbers",
            "Supporting document description (mandatory, short text)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "Cancellation requests": {
          "Saved Application Cancel": [
            "Enter CAN Number from which application was created (optional)",
            "Application Number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "In progress Application": [
            "Enter CAN Number from which application was created (optional)",
            "Application Number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Returned Application Cancel": [
            "Enter CAN Number from which application was created (optional)",
            "Application Number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Approved certificate/ Application cancellation": [
            "Enter CAN Number from which application was created (Alphanumeric field) (optional)",
            "Enter application/ certificate number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (mandatory, short text)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "User access related": {
          "Department user- password reset": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "centre eDistrict ID- password reset": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "centre eDistrict ID- ID unlock": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "eSevai centre login- password reset": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Helpdesk": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Citizen ID- login errors": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Citizen ID- password reset": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Citizen ID- OTP related": [
            "Enter eSevai log in ID (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        },
        "Biometric related": {
          "Biometric related": [
            "Enter eSevai log in ID (Alphanumeric field) (mandatory)",
            "Enter type of device (mandatory)",
            "Enter model of device (mandatory)",
            "Enter description of error (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "eSign related": {
          "Application/certificate unable to sign from Official login": [
            "Enter CAN Number from which application was created (optional)",
            "Enter application/ certificate number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Approved application has no signature": [
            "Enter CAN Number from which application was created (optional)",
            "Enter application/ certificate number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Unable to validate signature": [
            "Enter CAN Number from which application was created (optional)",
            "Enter application/ certificate number (mandatory)",
            "Enter description: Reason for request (mandatory)",
            "Supporting document description (optional, short text)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        },
        "Service-specific Grievances": {
          "Application form related": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Issues with drop-down menus": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Issues in selecting street/ location details": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Already applied services error": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Application approval related": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Certificate download related": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application acknowledgement number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "Payment": {
          "Unable to Make Payment": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Application failed before payment gateway": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Transaction Failed": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Duplicate Transaction": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Refund": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Others": [
            "Enter CAN Number (Alphanumeric field) (optional)",
            "Enter application number (optional)",
            "Enter transaction number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "Acknowledgements": {
          "Reprint Receipt": [
            "Enter application number (mandatory)",
            "Enter description of the issue (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        },
        "Server Issue": {
          "Website Error": [
            "Enter description of the issue",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Website is slow": [
            "Enter description of the issue",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Others": [
            "Enter description of the issue",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        },
        "Pendency status issues": {
          "Not matching with CRA pendency": [
            "Application numbers (optional)",
            "Enter the official login details where the pendency shows incorrectly",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ],
          "Approved/Rejected applications showing in pendency": [
            "Application numbers (optional)",
            "Enter the official login details where the pendency shows incorrectly",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]

        },
        "Others": {
          "null": [
            "Enter description of the issue (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        }
      },

      "eSevai centre related": {
        "Centre-related complaints/ grievances": {
          "Overcharging": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Rude behaviour": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Non-compliance with centre guidelines": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Misuse of ID": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Other malpractices": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ],
          "Others": [
            "Enter eSevai centre ID against whom the grievance is lodged (mandatory)",
            "Enter description of issue faced (mandatory)",
            "Attach supporting document (optional) (provision to attach more than one document- optional)"
          ]
        },
        "New Application": {
          "New eSevai Centre Application": [
            "Enter description of the request (mandatory)",
            "Attach supporting document (mandatory) (provision to attach more than one document- optional)"
          ]
        },
        "ID Block": {
          "ID Block reactivation": [
            "Enter eSevai centre ID to be reactivated (mandatory)",
            "Enter reason for ID block (drop down- ID blocked due to Zero transactions, ID blocked due to overcharging issues , Donâ€™t know) (mandatory)",
            "Attach supporting document (optional)"
          ]
        },
        "Wallet Recharge Issue": {
          "Wallet Recharge Error": [
            "Enter the amount of recharge requested (mandatory)",
            "Enter the date of the recharge request (mandatory)",
            "Enter error message of the issue (Optional)",
            "Attach supporting document (optional)"
          ],
          "Others": ["Enter description of issue faced (mandatory)",
            "Enter the date of the recharge request (mandatory)",
            "Enter error message of the issue (Optional)",
            "Attach supporting document (optional)"],
          "Refund, amount deducted": ["Enter description of issue faced (mandatory)",
            "Enter the date of the recharge request (mandatory)",
            "Enter error message of the issue (Optional)",
            "Attach supporting document (optional)"],
          "Wallet Push": ["Enter description of issue faced (mandatory)",
            "Enter the date of the recharge request (mandatory)",
            "Enter error message of the issue (Optional)",
            "Attach supporting document (optional)"],
          "Wallet Shows Incorrect Amount": ["Enter description of issue faced (mandatory)",
            "Enter the date of the recharge request (mandatory)",
            "Enter error message of the issue (Optional)",
            "Attach supporting document (optional)"]
        },
        "Relocation request": {
          "Relocation request": [
            "Enter e-Sevai ID (mandatory)",
            "Current address of the center (mandatory)",
            "New address of the center (mandatory)",
            "Reason for relocation (mandatory)",
            "Whether moving from Rural to Urban location (drop down- Yes/ No) (mandatory)"
          ]
        },
        "Training related": {
          "Online LMS (Payil) login issues": [
            "Enter description of the issue (mandatory)",
            "Attach supporting document (optional)"
          ],
          "In-person training sessions": [
            "Enter description of the issue (mandatory)",
            "Attach supporting document (optional)"
          ]
        },
        "Centre details updation": {
          "Operator Details update": [
            "Current operator Name: (mandatory)",
            "Current operator mobile number: (mandatory)",
            "Reason for operator change: (mandatory)",
            "New operator name: (mandatory)",
            "New operator mobile number: (mandatory)",
            "Attach supporting document (optional)"
          ],
          "Phone number update": [
            "Current registered mobile number: (mandatory)",
            "Reason for change: (mandatory)",
            "New registered mobile number: (mandatory)",
            "Attach supporting document (optional)"
          ],
          "Location details update": [
            "Current registered address: (mandatory)",
            "Reason for change: (mandatory)",
            "New registered address: (mandatory)",
            "Attach supporting document (optional)"
          ]
        },
        "Others": {
          "null": [
            "Enter description of the issue (mandatory)",
            "Attach supporting document (optional)"
          ]
        }
      },
      "eSevai officials related": {
        "eDM": {
          "null": [
            "Enter description of issue faced (mandatory)",
            "Enter name of official (optional)",
            "Attach supporting document (optional)"
          ]
        },
        "Helpdesk": {
          "null": ["Enter description of issue faced (mandatory)",
            "Enter name of official (optional)",
            "Attach supporting document (optional)"]
        },
        "TNeGA eSevai operations team": {
          "null": ["Enter description of issue faced (mandatory)",
            "Enter name of official (optional)",
            "Attach supporting document (optional)"
          ]
        }
      }
    };

    // Dummy encrypt/decrypt functions
    function encryptData(data) {
      return btoa(JSON.stringify(data));
    }

    function decryptData(data) {
      try {
        if (typeof data === "string") {
          data = data.trim();
          if ((data.startsWith("{") && data.endsWith("}")) || (data.startsWith("[") && data.endsWith("]"))) {
            return JSON.parse(data);
          } else {
            console.warn("decryptData received non-JSON string:", data);
            return [];
          }
        }
        return data;
      } catch (e) {
        console.error("Decryption/JSON parse error:", e, "Data received:", data);
        return [];
      }
    }

    $(document).ready(function () {
      const roleId = localStorage.getItem("role_id") || "1";

      // ðŸ”¹ TYPE DROPDOWN API
      const typePayload = {
        action: "function_call",
        function_name: "fn_issue_type",
        params: { roleid: roleId }
      };

      $.ajax({
        url: `${BASE_API_URL}/commonfunction`,
        method: "POST",
        data: { data: encryptData(typePayload) },
        dataType: "text", // use text to avoid JSON parse errors
        success(responseText) {
          if (!responseText || responseText.startsWith("Decryption")) {
            console.error("fn_issue_type error:", responseText);
            return;
          }

          const decrypted = decryptData(responseText);
          if (!Array.isArray(decrypted) || decrypted.length === 0) {
            console.warn("fn_issue_type returned empty data:", decrypted);
            return;
          }

          const $dropdown = $("#typeSelect");
          $dropdown.empty().append('<option value="">--Select Type--</option>');
          decrypted.forEach(item => {
            // Use the exact key in formConfig as value
            const key = item.issue_name.toLowerCase().replace(/&/g, "and");
            $dropdown.append(`<option value="${key}">${item.issue_name}</option>`);
          });
        },
        error(xhr, status, error) {
          console.error("fn_issue_type API Error:", error);
        }
      });

      // ðŸ”¹ CATEGORY DROPDOWN API
      $('#typeSelect').on('change', function () {
        const selectedType = $(this).val();
        if (!selectedType) return;

        const categoryPayload = {
          action: "function_call",
          function_name: "fn_issue_category",
          params: { type: selectedType, roleid: roleId }
        };

        $.ajax({
          url: `${BASE_API_URL}/commonfunction`,
          method: "POST",
          data: { data: encryptData(categoryPayload) },
          dataType: "text",
          success(responseText) {
            if (!responseText || responseText.startsWith("Decryption")) {
              console.error("fn_issue_category error:", responseText);
              return;
            }
            const decrypted = decryptData(responseText);
            if (!Array.isArray(decrypted) || decrypted.length === 0) {
              console.warn("fn_issue_category returned empty data:", decrypted);
              return;
            }
            const $dropdown = $('#categorySelect');
            $dropdown.empty().append('<option value="">--Select Category--</option>');
            decrypted.forEach(item => {
              const key = item.issue_name; // use exact JSON key if needed
              $dropdown.append(`<option value="${key}">${item.issue_name}</option>`);
            });
          },
          error(xhr, status, error) {
            console.error("fn_issue_category API Error:", error);
          }
        });
      });

      // ðŸ”¹ SUB CATEGORY DROPDOWN API
      $('#categorySelect').on('change', function () {
        const selectedCategory = $(this).val();
        if (!selectedCategory) return;

        const subPayload = {
          action: "function_call",
          function_name: "fn_issue_subcategory",
          params: { type: selectedCategory, roleid: roleId }
        };

        $.ajax({
          url: `${BASE_API_URL}/commonfunction`,
          method: "POST",
          data: { data: encryptData(subPayload) },
          dataType: "text",
          success(responseText) {
            if (!responseText || responseText.startsWith("Decryption")) {
              console.error("fn_issue_subcategory error:", responseText);
              return;
            }
            const decrypted = decryptData(responseText);
            if (!Array.isArray(decrypted) || decrypted.length === 0) {
              console.warn("fn_issue_subcategory returned empty data:", decrypted);
              return;
            }
            const $dropdown = $('#subCategorySelect');
            $dropdown.empty().append('<option value="">--Select Sub Category--</option>');
            decrypted.forEach(item => {
              const key = item.issue_name; // use exact JSON key if needed
              $dropdown.append(`<option value="${key}">${item.issue_name}</option>`);
            });
          },
          error(xhr, status, error) {
            console.error("fn_issue_subcategory API Error:", error);
          }
        });
      });

      // ðŸ”¹ Build dynamic fields
      $('#subCategorySelect').on('change', function () {
        const typeKey = $('#typeSelect').val();
        const categoryKey = $('#categorySelect').val();
        const subCategoryKey = $('#subCategorySelect').val();

        $('#formFields').empty();

        const fields = formConfig[typeKey]?.[categoryKey]?.[subCategoryKey] || [];
        fields.forEach(field => {
          const isFile = field.toLowerCase().includes("attach supporting document");
          const mandatory = field.toLowerCase().includes("(mandatory)") || false;
          if (isFile) {
            $('#formFields').append(`
            <div class="mb-3">
              <label class="form-label">${field}${mandatory ? ' *' : ''}</label>
              <input type="file" class="form-control dynamic-field" data-label="${field}" ${mandatory ? 'required' : ''} multiple>
              <small class="text-danger">* Max. file size 1 MB each</small>
              <div class="error-message"></div>
            </div>
          `);
          } else {
            $('#formFields').append(`
            <div class="mb-3">
              <label class="form-label">${field}${mandatory ? ' *' : ''}</label>
              <input type="text" class="form-control dynamic-field" data-label="${field}" ${mandatory ? 'required' : ''}>
              <div class="error-message"></div>
            </div>
          `);
          }
        });
      });

      // ðŸ”¹ Validation helpers
      function showError(input, message) {
        input.addClass("is-invalid");
        input.siblings(".error-message").text(message);
      }
      function clearError(input) {
        input.removeClass("is-invalid");
        input.siblings(".error-message").text("");
      }

      // ðŸ”¹ Submit handler
      $("#issueForm").on("submit", function (e) {
        e.preventDefault();
        let isValid = true;

        // Validate dropdowns
        ["#typeSelect", "#categorySelect", "#subCategorySelect"].forEach(sel => {
          const $el = $(sel);
          if (!$el.val()) {
            showError($el, "This field is required");
            isValid = false;
          } else clearError($el);
        });

        // Validate dynamic fields
        $("#formFields .dynamic-field").each(function () {
          const $input = $(this);
          if ($input.prop("required") && !$input.val()) {
            showError($input, `${$input.data("label")} is required`);
            isValid = false;
          } else if ($input.attr("type") === "file" && $input[0].files.length) {
            Array.from($input[0].files).forEach(file => {
              if (file.size > 1024 * 1024) {
                showError($input, `File "${file.name}" exceeds 1 MB`);
                isValid = false;
              }
            });
          } else clearError($input);
        });

        if (!isValid) return;

        // Collect values
        const formData = {
          type: $("#typeSelect").val(),
          category: $("#categorySelect").val(),
          subCategory: $("#subCategorySelect").val(),
          fields: {}
        };
        $("#formFields .dynamic-field").each(function () {
          const $input = $(this);
          const label = $input.data("label");
          if ($input.attr("type") === "file") {
            formData.fields[label] = Array.from($input[0].files).map(f => f.name);
          } else {
            formData.fields[label] = $input.val();
          }
        });

        console.log("Form submitted successfully:", formData);
        alert("Form submitted successfully! Check console for details.");
      });

      // ðŸ”¹ Remove error instantly on input/change
      $(document).on("input change", ".dynamic-field, #typeSelect, #categorySelect, #subCategorySelect", function () {
        clearError($(this));
      });
    });
  </script>






</body>

</html>